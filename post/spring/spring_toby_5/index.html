<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[토비의 스프링 3.1] 5장 정리 - 1 | slow-wave blog</title><meta name=keywords content="Spring,Backend,Java"><meta name=description content="5-1. 사용자 레벨 관리 기능 추가 정해진 조건에 따라 사용자의 레벨을 변경하는 기능 추가 5.1.1 필드 추가 Level 이늄 사용자 레벨을 이늄(enum)으로 정의 public enum Level { Basic(1), SILVER(2), GOLD(3); private final int value; Level(int value) { this.value=value; } public int intValue() { return value; } public static Level valueOf(int value) { switch(value) { case 1: return BASIC; case 2: return SILVER; case 3: return GOLD; default: throw new AssertionError(&#34;Unknown value: &#34;+ value&#34;); } } } User 필드 추가 public class User { ."><meta name=author content="Me"><link rel=canonical href=http://slow-wave.github.io/post/spring/spring_toby_5/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://slow-wave.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://slow-wave.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://slow-wave.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://slow-wave.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://slow-wave.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-6F557TM67S"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6F557TM67S",{anonymize_ip:!1})}</script><meta property="og:title" content="[토비의 스프링 3.1] 5장 정리 - 1"><meta property="og:description" content="5-1. 사용자 레벨 관리 기능 추가 정해진 조건에 따라 사용자의 레벨을 변경하는 기능 추가 5.1.1 필드 추가 Level 이늄 사용자 레벨을 이늄(enum)으로 정의 public enum Level { Basic(1), SILVER(2), GOLD(3); private final int value; Level(int value) { this.value=value; } public int intValue() { return value; } public static Level valueOf(int value) { switch(value) { case 1: return BASIC; case 2: return SILVER; case 3: return GOLD; default: throw new AssertionError(&#34;Unknown value: &#34;+ value&#34;); } } } User 필드 추가 public class User { ."><meta property="og:type" content="article"><meta property="og:url" content="http://slow-wave.github.io/post/spring/spring_toby_5/"><meta property="og:image" content="http://slow-wave.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-01-14T23:28:01+09:00"><meta property="article:modified_time" content="2023-01-14T23:28:01+09:00"><meta property="og:site_name" content="slow-wave blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://slow-wave.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[토비의 스프링 3.1] 5장 정리 - 1"><meta name=twitter:description content="5-1. 사용자 레벨 관리 기능 추가 정해진 조건에 따라 사용자의 레벨을 변경하는 기능 추가 5.1.1 필드 추가 Level 이늄 사용자 레벨을 이늄(enum)으로 정의 public enum Level { Basic(1), SILVER(2), GOLD(3); private final int value; Level(int value) { this.value=value; } public int intValue() { return value; } public static Level valueOf(int value) { switch(value) { case 1: return BASIC; case 2: return SILVER; case 3: return GOLD; default: throw new AssertionError(&#34;Unknown value: &#34;+ value&#34;); } } } User 필드 추가 public class User { ."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://slow-wave.github.io/post/"},{"@type":"ListItem","position":2,"name":"[토비의 스프링 3.1] 5장 정리 - 1","item":"http://slow-wave.github.io/post/spring/spring_toby_5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[토비의 스프링 3.1] 5장 정리 - 1","name":"[토비의 스프링 3.1] 5장 정리 - 1","description":"5-1. 사용자 레벨 관리 기능 추가 정해진 조건에 따라 사용자의 레벨을 변경하는 기능 추가 5.1.1 필드 추가 Level 이늄 사용자 레벨을 이늄(enum)으로 정의 public enum Level { Basic(1), SILVER(2), GOLD(3); private final int value; Level(int value) { this.value=value; } public int intValue() { return value; } public static Level valueOf(int value) { switch(value) { case 1: return BASIC; case 2: return SILVER; case 3: return GOLD; default: throw new AssertionError(\u0026#34;Unknown value: \u0026#34;+ value\u0026#34;); } } } User 필드 추가 public class User { .","keywords":["Spring","Backend","Java"],"articleBody":"5-1. 사용자 레벨 관리 기능 추가 정해진 조건에 따라 사용자의 레벨을 변경하는 기능 추가 5.1.1 필드 추가 Level 이늄 사용자 레벨을 이늄(enum)으로 정의 public enum Level { Basic(1), SILVER(2), GOLD(3); private final int value; Level(int value) { this.value=value; } public int intValue() { return value; } public static Level valueOf(int value) { switch(value) { case 1: return BASIC; case 2: return SILVER; case 3: return GOLD; default: throw new AssertionError(\"Unknown value: \"+ value\"); } } } User 필드 추가 public class User { ... Level level; int login; int recommend; public Level getLevel() { return level; } public void setLevel(Level level) { this.level=level; } } UserDaoTest 테스트 수정\nUserDaoJdbc 수정\n빠르게 실행 가능한 포괄적인 테스트를 만드는 것이 중요하다. 5.1.2 사용자 수정 기능 추가 사용자 관리 비즈니스 로직에 따르면 사용자 정보는 여러번 수정 될 수 있음. 수정 기능 테스트 추가 수정할 정보가 담긴 User 오브젝트를 전달하면 id를 참고해서 사용자를 찾아 필드 정보 UPDATE해주는 메소드 추가 UserDao와 UserDaoJdbc 수정 update() 메소드 추가 public interface UserDao { ... public void update(User user1); } 사용자 정보 수정용 update() 메소드 public void update(User user) { this.jdbcTemplate.update( \"update users set name=?, password=?, level=?, login=?,\" + \"recommend=? where id=?\", user.getName(), user.getPassword()), user.getLevel().intValue, user.getLogin(), user.getRecommend(), user.getId()); } 수정 테스트 보완 위의 update() 메소드의 문제점 UPDATE 문에서 WHERE 절을 빼먹는 경우는 검증하지 못함. 해결법 첫번째 방법) JdbcTemplate의 update()가 돌려주는 리턴 값(영향 주는 로우 개수)이 1인지 확인. 두번째 방법) 테스트를 보강해서 원하는 사용자 외의 정보는 변경되지 않았음을 확인. 사용자를 2명 등록해서 하나만 수정한 뒤에 두사람의 정보를 확인해본다. 5.1.3 UserService.upgradeLevels() 사용자 관리 로직의 경우 UserDaoJdbc에 두는 것은 적합하지 않음. (DAO는 비즈니스 로직을 두는 곳이 아니다.) 사용자 관리 비즈니스 로직을 담을 클래스 추가. → UserService UserDao 인터페이스 타입으로 UserDao 빈을 DI 받아 사용한다. UserService는 UserDao의 구현 클래스가 바뀌어도 영향받지 않도록 해야함. UserService를 위한 테스트 클래스도 추가 → UserServiceTest UserService 클래스와 빈 등록 UserService클래스 만들고 사용할 UserDao 오브젝트를 저장해둘 인스턴스 변수 선언 스프링 설정파일에 userService 아이디로 빈 추가 ","wordCount":"815","inLanguage":"en","datePublished":"2023-01-14T23:28:01+09:00","dateModified":"2023-01-14T23:28:01+09:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://slow-wave.github.io/post/spring/spring_toby_5/"},"publisher":{"@type":"Organization","name":"slow-wave blog","logo":{"@type":"ImageObject","url":"http://slow-wave.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://slow-wave.github.io/ accesskey=h title="Home (Alt + H)"><img src=http://slow-wave.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://slow-wave.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=http://slow-wave.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=http://slow-wave.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://slow-wave.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://slow-wave.github.io/post/>Posts</a></div><h1 class=post-title>[토비의 스프링 3.1] 5장 정리 - 1</h1><div class=post-meta><span title='2023-01-14 23:28:01 +0900 KST'>January 14, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;815 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/post/spring/spring_toby_5.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#5-1-사용자-레벨-관리-기능-추가>5-1. 사용자 레벨 관리 기능 추가</a><ul><li><a href=#511-필드-추가>5.1.1 필드 추가</a></li><li><a href=#512-사용자-수정-기능-추가>5.1.2 사용자 수정 기능 추가</a></li><li><a href=#513-userserviceupgradelevels>5.1.3 UserService.upgradeLevels()</a></li><li><a href=#514-userserviceadd>5.1.4 UserService.add()</a></li><li><a href=#515-코드-개선>5.1.5 코드 개선</a></li></ul></li><li><a href=#참고-자료>참고 자료</a></li></ul></nav></div></details></div><div class=post-content><h2 id=5-1-사용자-레벨-관리-기능-추가>5-1. 사용자 레벨 관리 기능 추가<a hidden class=anchor aria-hidden=true href=#5-1-사용자-레벨-관리-기능-추가>#</a></h2><ul><li>정해진 조건에 따라 사용자의 레벨을 변경하는 기능 추가</li></ul><h3 id=511-필드-추가>5.1.1 필드 추가<a hidden class=anchor aria-hidden=true href=#511-필드-추가>#</a></h3><ol><li>Level 이늄</li></ol><ul><li>사용자 레벨을 이늄(enum)으로 정의<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>Level</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>Basic</span><span class=o>(</span><span class=n>1</span><span class=o>),</span> <span class=n>SILVER</span><span class=o>(</span><span class=n>2</span><span class=o>),</span> <span class=n>GOLD</span><span class=o>(</span><span class=n>3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>Level</span><span class=o>(</span><span class=kt>int</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>this</span><span class=o>.</span><span class=na>value</span><span class=o>=</span><span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>int</span> <span class=nf>intValue</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=n>Level</span> <span class=nf>valueOf</span><span class=o>(</span><span class=kt>int</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>switch</span><span class=o>(</span><span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=n>1</span><span class=o>:</span> <span class=k>return</span> <span class=n>BASIC</span><span class=o>;</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=n>2</span><span class=o>:</span> <span class=k>return</span> <span class=n>SILVER</span><span class=o>;</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=n>3</span><span class=o>:</span> <span class=k>return</span> <span class=n>GOLD</span><span class=o>;</span>
</span></span><span class=line><span class=cl>			<span class=k>default</span><span class=o>:</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>AssertionError</span><span class=o>(</span><span class=s>&#34;Unknown value: &#34;</span><span class=o>+</span> <span class=n>value</span><span class=err>&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></li></ul><ol start=2><li>User 필드 추가</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span>
</span></span><span class=line><span class=cl>	<span class=n>Level</span> <span class=n>level</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>login</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span> <span class=n>recommend</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>Level</span> <span class=nf>getLevel</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>level</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>setLevel</span><span class=o>(</span><span class=n>Level</span> <span class=n>level</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>level</span><span class=o>=</span><span class=n>level</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ol start=3><li><p>UserDaoTest 테스트 수정</p></li><li><p>UserDaoJdbc 수정</p></li></ol><ul><li>빠르게 실행 가능한 포괄적인 테스트를 만드는 것이 중요하다.</li></ul><h3 id=512-사용자-수정-기능-추가>5.1.2 사용자 수정 기능 추가<a hidden class=anchor aria-hidden=true href=#512-사용자-수정-기능-추가>#</a></h3><ul><li>사용자 관리 비즈니스 로직에 따르면 사용자 정보는 여러번 수정 될 수 있음.</li></ul><ol><li>수정 기능 테스트 추가</li></ol><ul><li>수정할 정보가 담긴 User 오브젝트를 전달하면 id를 참고해서 사용자를 찾아 필드 정보 UPDATE해주는 메소드 추가</li></ul><ol start=2><li>UserDao와 UserDaoJdbc 수정</li></ol><ul><li>update() 메소드 추가</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>UserDao</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>update</span><span class=o>(</span><span class=n>User</span> <span class=n>user1</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li>사용자 정보 수정용 update() 메소드</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>update</span><span class=o>(</span><span class=n>User</span> <span class=n>user</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=k>this</span><span class=o>.</span><span class=na>jdbcTemplate</span><span class=o>.</span><span class=na>update</span><span class=o>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;update users set name=?, password=?, level=?, login=?,&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;recommend=? where id=?&#34;</span><span class=o>,</span> <span class=n>user</span><span class=o>.</span><span class=na>getName</span><span class=o>(),</span> <span class=n>user</span><span class=o>.</span><span class=na>getPassword</span><span class=o>()),</span>
</span></span><span class=line><span class=cl>	<span class=n>user</span><span class=o>.</span><span class=na>getLevel</span><span class=o>().</span><span class=na>intValue</span><span class=o>,</span> <span class=n>user</span><span class=o>.</span><span class=na>getLogin</span><span class=o>(),</span> <span class=n>user</span><span class=o>.</span><span class=na>getRecommend</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>	<span class=n>user</span><span class=o>.</span><span class=na>getId</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ol start=3><li>수정 테스트 보완</li></ol><ul><li>위의 update() 메소드의 문제점<ul><li>UPDATE 문에서 WHERE 절을 빼먹는 경우는 검증하지 못함.</li></ul></li><li>해결법<ul><li>첫번째 방법) JdbcTemplate의 update()가 돌려주는 리턴 값(영향 주는 로우 개수)이 1인지 확인.</li><li>두번째 방법) 테스트를 보강해서 원하는 사용자 외의 정보는 변경되지 않았음을 확인.<ul><li>사용자를 2명 등록해서 하나만 수정한 뒤에 두사람의 정보를 확인해본다.</li></ul></li></ul></li></ul><h3 id=513-userserviceupgradelevels>5.1.3 UserService.upgradeLevels()<a hidden class=anchor aria-hidden=true href=#513-userserviceupgradelevels>#</a></h3><ul><li>사용자 관리 로직의 경우 UserDaoJdbc에 두는 것은 적합하지 않음. (DAO는 비즈니스 로직을 두는 곳이 아니다.)</li><li>사용자 관리 비즈니스 로직을 담을 클래스 추가. → UserService<ul><li>UserDao 인터페이스 타입으로 UserDao 빈을 DI 받아 사용한다.</li></ul></li><li>UserService는 UserDao의 구현 클래스가 바뀌어도 영향받지 않도록 해야함.</li><li>UserService를 위한 테스트 클래스도 추가 → UserServiceTest</li></ul><ol><li>UserService 클래스와 빈 등록</li></ol><ul><li>UserService클래스 만들고 사용할 UserDao 오브젝트를 저장해둘 인스턴스 변수 선언</li><li>스프링 설정파일에 userService 아이디로 빈 추가</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&#34;userService&#34;</span> <span class=na>class=</span><span class=s>&#34;springbook.user.service.UserService&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;userDao&#34;</span> <span class=na>ref=</span><span class=s>&#34;userDao&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/bean&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&#34;userDao&#34;</span> <span class=na>class=</span><span class=s>&#34;springbook.dao.UserDaoJdbc&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;dataSource&#34;</span> <span class=na>ref=</span><span class=s>&#34;dataSource&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/bean&gt;</span>
</span></span></code></pre></div><ol start=2><li>UserServiceTest 테스트 클래스</li></ol><ul><li>테스트 대상인 UserService 빈을 제공받을 수 있도록 @Autowired가 붙은 인스턴스 변수로 선언.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>springbook.user.service</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nd>@RunWith</span><span class=o>(</span><span class=n>SpringJUnit4ClassRunner</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@ContextCongifuration</span><span class=o>(</span><span class=n>locations</span><span class=o>=</span><span class=s>&#34;/test-applicationContext.xml&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserServiceTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=n>UserService</span> <span class=n>userService</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li>테스트 메소드 추가</li></ul><ol start=3><li>upgradeLevels() 메소드</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>upgradeLevels</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span> <span class=n>users</span><span class=o>=</span><span class=n>userdao</span><span class=o>.</span><span class=na>getAll</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=o>(</span><span class=n>User</span> <span class=n>user</span><span class=o>:</span> <span class=n>users</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>Boolean</span> <span class=n>changes</span><span class=o>=</span><span class=kc>null</span><span class=o>;</span> <span class=c1>//레벨 변화 확인
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>//BASIC 레벨 업그레이드
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span><span class=o>(</span><span class=n>user</span><span class=o>.</span><span class=na>getLevel</span><span class=o>()==</span><span class=n>Level</span><span class=o>.</span><span class=na>BASIC</span><span class=o>&amp;&amp;</span><span class=n>user</span><span class=o>.</span><span class=na>getLogin</span><span class=o>()&gt;=</span><span class=n>50</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>user</span><span class=o>.</span><span class=na>setLevel</span><span class=o>(</span><span class=n>Level</span><span class=o>.</span><span class=na>SILVER</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=n>changed</span><span class=o>=</span><span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>//SILVER 레벨 업그레이드
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>else</span> <span class=k>if</span><span class=o>(</span><span class=n>user</span><span class=o>.</span><span class=na>getLevel</span><span class=o>()==</span><span class=n>Level</span><span class=o>.</span><span class=na>SILVER</span><span class=o>&amp;&amp;</span><span class=n>user</span><span class=o>.</span><span class=na>getRecommend</span><span class=o>()&gt;=</span><span class=n>30</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>user</span><span class=o>.</span><span class=na>setLevel</span><span class=o>(</span><span class=n>Level</span><span class=o>.</span><span class=na>GOLD</span><span class=o>);</span>
</span></span><span class=line><span class=cl>			<span class=n>changes</span><span class=o>=</span><span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>//GOLD 레벨 업그레이드
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>user</span><span class=o>.</span><span class=na>getLevel</span><span class=o>()==</span><span class=n>Level</span><span class=o>.</span><span class=na>GOLD</span><span class=o>)</span> <span class=o>{</span><span class=n>changed</span><span class=o>=</span><span class=kc>false</span><span class=o>;}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>(</span><span class=n>changed</span><span class=o>)</span> <span class=o>{</span><span class=n>userDao</span><span class=o>.</span><span class=na>update</span><span class=o>(</span><span class=n>user</span><span class=o>);}</span> <span class=c1>//변경 있는 경우에만 update() 호출
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ol start=4><li>upgradeLevels() 테스트</li></ol><ul><li>경계가 되는 값으로 설정해 테스트를 진행한다.</li></ul><h3 id=514-userserviceadd>5.1.4 UserService.add()<a hidden class=anchor aria-hidden=true href=#514-userserviceadd>#</a></h3><ul><li>처음 가입하는 사용자의 경우 BASIC 레벨로 설정하는 것 구현해야함.</li><li>UserDaoJdbc의 add()메소드는 적합하지 않음. 비즈니스 적인 의미를 지닌 정보를 설정하는 책임을 지는 것은 적합하지 않음.</li><li>방법1) User클래스에서 level 필드를 Level.BASIC으로 초기화<ul><li>처음 가입할 떄를 제외하면 무의미한 필드이기 때문에 문제가 있어 보임.</li></ul></li><li>방법2) 사용자 관리에 대한 비즈니스 로직을 담고 있는 UserService에 넣기<ul><li>UserServcie의 add()를 호출하면 레벨이 BASIC으로 설정</li></ul></li><li>테스트 케이스<ul><li><ol><li>레벨이 미리 정해진 경우에는 레벨 초기화 불필요</li></ol></li><li><ol start=2><li>레벨이 비어있는 경우에는 BASIC 레벨로 설정</li></ol></li></ul></li></ul><h3 id=515-코드-개선>5.1.5 코드 개선<a hidden class=anchor aria-hidden=true href=#515-코드-개선>#</a></h3><ul><li>코드에 중복된 부분은 없는가?</li><li>코드가 무엇을 하는 것인지 이해하기 불편하지 않은가?</li><li>앞으로 변경이 일어난다면 어떤 것이 있을 수 있고, 그 변화에 쉽게 대응할 수 있는가?</li></ul><ol><li>upgradeLevels() 메소드 코드의 문제점</li></ol><ul><li>문제점<ul><li>if/elseif/else 블록들이 읽기 불편함.</li><li>로직을 이해하기 쉽지 않음.</li></ul></li><li>레벨 확인 → 각 레벨별로 조건 판단하는 조건식 넣는 로직으로 바꿔야함.</li></ul><ol start=2><li>upgradeLevels() 리팩토링</li></ol><ul><li>기본 작업 흐름만 남겨둔 upgradeLevels()</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>upgradeLevels</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span> <span class=n>users</span> <span class=o>=</span> <span class=n>userDao</span><span class=o>.</span><span class=na>getAll</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=o>(</span><span class=n>User</span> <span class=n>user</span><span class=o>:</span> <span class=n>users</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=o>(</span> <span class=n>canUpgradeLevel</span><span class=o>(</span><span class=n>user</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>			<span class=n>upgradeLevel</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li>canUpgradeLevel() 메소드</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>canUpgradeLevel</span><span class=o>(</span><span class=n>User</span> <span class=n>user</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>Level</span> <span class=n>currentLevel</span><span class=o>=</span><span class=n>user</span><span class=o>.</span><span class=na>getLevel</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=k>switch</span><span class=o>(</span><span class=n>currentLevel</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=n>BASIC</span><span class=o>:</span> <span class=k>return</span> <span class=o>(</span><span class=n>user</span><span class=o>.</span><span class=na>getLogin</span><span class=o>()</span> <span class=o>&gt;=</span> <span class=n>50</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=n>SILVER</span><span class=o>:</span> <span class=k>return</span> <span class=o>(</span><span class=n>user</span><span class=o>.</span><span class=na>getRecommend</span><span class=o>()&gt;=</span><span class=n>30</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=n>GOLD</span><span class=o>:</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=c1>//현재 로직에서 다룰 수 없는 레벨이라면 예외 발생 시킴.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>default</span><span class=o>:</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Unknown Level:&#34;</span><span class=o>+</span><span class=n>currentLevel</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li><p>upgradeLevel() 메소드</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>upgradeLevel</span><span class=o>(</span><span class=n>User</span> <span class=n>user</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=o>(</span><span class=n>user</span><span class=o>.</span><span class=na>getLevel</span><span class=o>()==</span><span class=n>Level</span><span class=o>.</span><span class=na>BASIC</span><span class=o>)</span> <span class=n>user</span><span class=o>.</span><span class=na>setLevel</span><span class=o>(</span><span class=n>Level</span><span class=o>.</span><span class=na>SILVER</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>user</span><span class=o>.</span><span class=na>getLevel</span><span class=o>()</span> <span class=o>==</span> <span class=n>Level</span><span class=o>.</span><span class=na>SILVER</span><span class=o>)</span> <span class=n>usre</span><span class=o>.</span><span class=na>setLevel</span><span class=o>(</span><span class=n>Level</span><span class=o>.</span><span class=na>GOLD</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=n>userDao</span><span class=o>.</span><span class=na>update</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li>다음 단계가 무엇인가 하는 로직과 그때 사용자 object의 level 필드를 변경해준다는 로직이 함께 있고, 노골적으로 들어남. 예외상황 처리도 없음.</li></ul></li><li><p>업그레이드 순서를 담고 있도록 수정한 Level</p><ul><li>레벨의 순서와 다음 단계 레벨이 무엇이 있는지는 Level에 정의</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>Level</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>Basic</span><span class=o>(</span><span class=n>1</span><span class=o>,</span> <span class=n>SILVER</span><span class=o>),</span> <span class=n>SILVER</span><span class=o>(</span><span class=n>2</span><span class=o>,</span> <span class=n>GOLD</span><span class=o>),</span> <span class=n>GOLD</span><span class=o>(</span><span class=n>3</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>final</span> <span class=n>Level</span> <span class=n>next</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>Level</span><span class=o>(</span><span class=kt>int</span> <span class=n>value</span><span class=o>,</span> <span class=n>Level</span> <span class=n>next</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>value</span><span class=o>=</span><span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>next</span><span class=o>=</span><span class=n>next</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>Level</span> <span class=nf>nextLevel</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>next</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li>User의 레벨 업그레이드 작업용 메소드</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>upgradeLevel</span><span class=o>(</span><span class=n>User</span> <span class=n>user</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>Level</span> <span class=n>nextlevel</span><span class=o>=</span><span class=k>this</span><span class=o>.</span><span class=na>level</span><span class=o>.</span><span class=na>nextLevel</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=o>(</span><span class=n>nextlvel</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>level</span><span class=o>+</span><span class=s>&#34;은 업그레이드가 불가능합니다.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>this</span><span class=o>.</span><span class=na>level</span><span class=o>=</span><span class=n>nextLevel</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li>upgradeLevel()</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>upgradeLevel</span><span class=o>(</span><span class=n>User</span> <span class=n>user</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=n>user</span><span class=o>.</span><span class=na>upgradeLevel</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=n>userDao</span><span class=o>.</span><span class=na>update</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><ul><li>오브젝트에게 데이터를 요구하지말고 작업을 요청하라는 것이 객체지향 프로그래밍의 가장 기본이 되는 원리이기도 하다.</li><li>UserService는 User에게 ‘레벨 업그레이드 작업’ 요청하고, 또 User는 Level에게 ‘다음 레벨이 무엇인지 알려달라’고 요청하는 방식이 바람직하다.</li></ul><ol start=3><li>User 테스트</li></ol><ul><li>upgradeLevel() 테스트는 Level 이늄을 가져와서 User에 설정해두고 User의 upgraeLevel()을 실행해서 다음 레벨로 바뀌는지 확인</li></ul><ol start=4><li>UserServiceTest 개선</li></ol><ul><li>업그레이드 조건 (로그인 횟수, 추천 횟수)숫자가 중복돼서 나타남. → 정수형 상수로 변경한다.<ul><li>무슨 의도로 어떤 값을 넣었는지 이해하기 쉬워짐.</li></ul></li></ul><h2 id=참고-자료>참고 자료<a hidden class=anchor aria-hidden=true href=#참고-자료>#</a></h2><ul><li><a href=https://product.kyobobook.co.kr/detail/S000000935358>[book] <strong>토비의 스프링 3.1 Vol 1: 스프링의 이해와 원리, 이일민</strong></a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://slow-wave.github.io/tags/spring/>Spring</a></li><li><a href=http://slow-wave.github.io/tags/backend/>Backend</a></li><li><a href=http://slow-wave.github.io/tags/java/>Java</a></li></ul><nav class=paginav><a class=prev href=http://slow-wave.github.io/post/spring/spring_toby_6/><span class=title>« Prev</span><br><span>[토비의 스프링 3.1] 5장 정리 - 2</span></a>
<a class=next href=http://slow-wave.github.io/post/spring/spring_toby_4/><span class=title>Next »</span><br><span>[토비의 스프링 3.1] 4장 정리</span></a></nav></footer><script src=https://utteranc.es/client.js repo=slow-wave/blog_comments issue-term=pathname theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=http://slow-wave.github.io/>slow-wave blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>